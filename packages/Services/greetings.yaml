template:
  - sensor:
      - name: Greeting Title
        icon: mdi:hand-wave
        state: >-
           {% set t = now().hour %}
           {% if t <= 0 %} Good Night
           {% elif t <= 6 %} Good Night
           {% elif t <= 11 %} Good Morning
           {% elif t <= 17 %} Good Afternoon
           {% elif t <= 20 %} Good Evening
           {% elif t <= 22 %} Good Night
           {% endif %}

  - sensor:
      - name: Greeting Body
        icon: mdi:hand-wave
        state: >
            {% if states('sensor.power_outage_today') == "True" %}<p>
            - There was a power outage today at {{ state_attr('input_datetime.last_power_outage', 'timestamp') | timestamp_custom('%I:%M %p') }}. {% endif %}
            
            {% if states('switch.water_boiler') == 'on' %}
            <p>- Water boiler has been running for {{ states('sensor.water_boiler_metrics_duration_last_time') }}.</p>
            {% elif states('switch.water_boiler') == 'off' %}
            <p>- Water boiler has finished {{ states('sensor.water_boiler_metrics_time_since_finished') }} ago, after being on for {{ states('sensor.water_boiler_metrics_duration_last_time') }}.</p>
            {% endif %}

            {% set t = now().hour %}
            {% if t <= 5 or t >= 22 %}<p>- It's rather late and the door is still unlocked.</p>{% endif %} 